"use strict";var Noise=Noise||{};!function(e){mejs.plugins.silverlight[0].types.push("video/x-ms-wmv"),mejs.plugins.silverlight[0].types.push("audio/x-ms-wma"),Noise.openVideosLightBox=function(a,t){var s=e(".inner").first().width(),i=600/1170;Noise.videoSlideshow=e(a).colorbox({ajax:!0,href:noiseVars.ajax_url,data:{action:"noise_get_video_player",id:t},width:s,height:i*s,fixed:!0,className:"video-player",close:'<i class="entypo-cross"></i>',onComplete:function(){var a={features:["playpause","progress","current","duration","volume","fullscreen"],alwaysShowControls:!1,pauseOtherPlayers:!0,enableAutosize:!1,success:function(e){e.addEventListener("ended",function(){Noise.videoSlideshow.flexslider("next")})}};e("video").each(function(){e(this).mediaelementplayer(a)}),Noise.videoSlideshow=e(".videos-slideshow").flexslider({animation:"slide",animationLoop:!1,slideshow:!1,controlNav:!1,start:function(a){e(window).trigger("resize"),1>=a.count&&e(a).find(".flex-direction-nav").hide()}})}})},e(function(){function a(){e("#tracks-info:visible .track-info.current").find(".scroll-pane").each(function(){e(this).mCustomScrollbar("update"),e(this).mCustomScrollbar("scrollTo","top")})}function t(a){Noise.player.setCurrentTrack(a.currentTrack),Noise.player.setSrc(a.currentTrack.data("url")),Noise.player.setCurrentRail(),Noise.player.updateTrackTitle();var t=e("#cboxLoadedContent .track-visual"),s=e("#tracks-detail #track-detail-"+a.currentTrack.data("id")),i=s.find(".track-meta .image").clone();i.removeClass("detail-image").append('<canvas id="visualization" class="visualization" height="120" width="1150"></canvas>'),t.children(".image").first().attr("style",i.attr("style")).children(".caption").remove(),t.children(".image").first().prepend(i.find(".caption")),t.find(".details").is(":visible")&&(t.find(".image").first().hide(),t.find(".details").html(s.html()),t.find(".details .scroll-pane").each(function(){Noise.initScrollBar(this)}))}"undefined"==typeof window.webkitAudioContext&&e("body").addClass("no-spectrum");var s={features:["icon","playlist","prev","playpause","next","tracktitle","rating","progress","current","duration","volume","info"],alwaysShowControls:!0,audioHeight:40,loop:!1,shuffle:!1,playlist:!0,pauseOtherPlayers:!1,afterNext:a,afterPrev:a,infoShow:function(){a(),Noise.$body.addClass("track-info-showed")},infoHide:function(){Noise.$body.removeClass("track-info-showed")},success:function(a){a.addEventListener("ended",function(){(!Noise.player.options.loop||Noise.player.options.playAll&&Noise.player.options.loop)&&(e(".play-track.entypo-pause").removeClass("entypo-pause"),e("li.playing").removeClass("playing")),!Noise.player.options.loop&&Noise.player.options.playAll&&Noise.player.currentTrack.is(":last-child")&&e(".play-album.entypo-pause").removeClass("entypo-pause"),(!Noise.player.options.loop||Noise.player.options.playAll)&&Noise.player.playNextTrack()},!1),a.addEventListener("pause",function(){e(".play-track.entypo-pause, .play-album.entypo-pause").removeClass("entypo-pause").addClass("paused")},!1),a.addEventListener("play",function(){e(".play-track.paused, .play-album.paused").addClass("entypo-pause").removeClass("paused"),Noise.player.currentTrack.addClass("played")},!1)}};"undefined"!=typeof _wpmejsSettings&&(s.pluginPath=_wpmejsSettings.pluginPath),e("#player").length&&(Noise.player=new MediaElementPlayer("#player",s),noiseVars.autoplay&&(Noise.player.load(),Noise.player.play()));var i=e(".player-playshuffle"),l=e(".player-playloop"),o=e("body");o.on("click",".player-playshuffle",function(){i.toggleClass("active"),Noise.player.shuffleToggle()}),o.on("click",".player-playloop",function(){l.toggleClass("active"),Noise.player.loopToggle()});var r={features:["icon","playlist","prev","playpause","next","shuffle","loop","progress","current","duration","volume","minimize"],alwaysShowControls:!0,audioHeight:40,loop:!1,shuffle:!1,playlist:!0,pauseOtherPlayers:!1,success:function(e){var a=!0;e.addEventListener("loadedmetadata",function(){if(a){var t=Noise.player.getCurrentTime();0!=t&&e.setCurrentTime(t),a=!1}},!1),e.addEventListener("play",function(){Noise.player.pause()},!1)},afterNext:function(e){t(e)},afterPrev:function(e){t(e)}};"undefined"!=typeof _wpmejsSettings&&(r.pluginPath=_wpmejsSettings.pluginPath),e("#tracks-info").on("click",".go-extended a",function(){var a=e(".inner").first().width();e(this).colorbox({ajax:!0,width:a,height:600,fixed:!0,overlayClose:!1,className:"extended-player",close:'<i class="entypo-cross"></i>',onComplete:function(){Noise.Spectrum.init(),Noise.extendedPlayer=new MediaElementPlayer("#extended-player",r),Noise.extendedPlayer.setSrc(Noise.player.currentTrack.data("url")),Noise.extendedPlayer.load(),Noise.extendedPlayer.play()},onClosed:function(){Noise.$body.hasClass("player-minimized")?Noise.$body.removeClass("player-minimized"):Noise.player.container.find(".mejs-info").trigger("click")}})}),o.on("click",".extended-player .caption a",function(a){a.preventDefault();var t=e(this),s=t.parents(".track-visual"),i=s.children(".details"),l=t.data("id");if(t.parents(".image").hasClass("detail-image"))return i.fadeOut(),s.children(".image").fadeIn(),void 0;if(i.is(":empty")||i.data("id")!=l){var o=e("#tracks-detail"),r=o.children("#track-detail-"+t.data("id"));if(r.length)s.children(".details").data("id",l).html(r.html()).fadeIn(500,function(){e(this).find(".track-lyric .scroll-pane").each(function(){Noise.initScrollBar(this)})}),t.parents(".image").fadeOut();else{var n=e('<div class="loading"></div>').appendTo(t.closest(".caption"));e.post(noiseVars.ajax_url,{action:"noise_get_track_detail",id:l},function(a){n.remove(),o.append(a),i.html(a).fadeIn(500,function(){e(this).find(".track-lyric .scroll-pane").each(function(){Noise.initScrollBar(this)})}),t.parents(".image").fadeOut()})}e.post(noiseVars.ajax_url,{action:"noise_update_views",id:l},function(){},"json")}else i.fadeIn(),t.parents(".image").fadeOut()}),o.on("hover",".vote-ui .heart",function(a){var t=e(this),s=t.closest(".vote-ui");s.hasClass("track-voted")||("mouseenter"==a.type&&(t.addClass("setted").removeClass("unset").prevAll(".heart").addClass("setted").removeClass("unset"),t.nextAll(".heart").addClass("unset")),"mouseout"==a.type&&t.removeClass("setted unset").siblings(".heart").removeClass("setted unset"))}),o.on("mouseout",".vote-ui",function(){var a=e(this);a.hasClass("track-voted")||a.children(".heart").removeClass("setted unset")}),o.on("click",".vote-ui .heart",function(a){a.preventDefault();var t=e(this),s=t.closest(".vote-ui"),i=s.data("id");s.hasClass("track-voted")||(t.addClass("entypo-heart").removeClass("entypo-heart2 unset setted").prevAll(".heart").addClass("entypo-heart").removeClass("entypo-heart2 unset setted"),t.nextAll(".heart").addClass("entypo-heart2").removeClass("entypo-heart unset setted"),e.post(noiseVars.ajax_url,{action:"noise_update_vote",id:i,score:t.index()+1,nonce:s.data("nonce")},function(a){if(a.success){s.addClass("track-voted"),e(".track-vote-"+i).addClass("track-voted");var l=t.parents(".details").html();e("#tracks-detail").children("#track-detail-"+i).html(l)}},"json"))}),o.on("click",".play-track",function(a){a.preventDefault();var t=e(this),s=t.data("url"),i=t.data("id");if(!s)return alert("Invalid Source"),void 0;if(t.hasClass("entypo-pause"))return Noise.player.pause(),void 0;if(t.hasClass("paused"))return Noise.player.play(),void 0;e(".play-track").removeClass("entypo-pause paused"),t.addClass("entypo-pause"),Noise.player.setSrc(s),Noise.player.load(),Noise.player.play();var l=Noise.player.playlist.children("li").filter(function(){return e(this).data("id")==i});l.length||(l=e("<li/>").attr("title",t.data("title")).data({url:s,id:i,rate:t.data("rate"),nonce:t.data("nonce")}).appendTo(Noise.player.playlist)),Noise.player.setCurrentTrack(l),Noise.player.updateTrackTitle(),Noise.player.updateTrackRating();var o=e("#tracks-info");if(o.children("#track-info-"+i).length>0)o.children(".current").removeClass("current"),o.children("#track-info-"+i).addClass("current");else{var r={action:"noise_get_track_info",id:i};e.post(noiseVars.ajax_url,r,function(e){o.append(e),o.children(".current").removeClass("current"),o.children("#track-info-"+i).addClass("current")})}}),o.on("click",".open-soundcloud",function(a){a.preventDefault(),Noise.soundcloud=e(this).colorbox({ajax:!0,href:noiseVars.ajax_url,data:{action:"noise_get_soundcloud_player",url:e(this).attr("href")},width:e(".inner").first().width(),fixed:!0,className:"soundcloud-player",close:'<i class="entypo-cross"></i>'})}),o.on("click",".open-videos",function(a){a.preventDefault(),e(".video .parallax").css("position"," static "),Noise.openVideosLightBox(this,e(this).data("id"))}),o.on("click",".play-album",function(a){a.preventDefault();{var t=e(this),s=t.parents(".album-cover").next(".album").find(".tracklist ol li");t.data("id")}if(t.hasClass("entypo-pause"))return Noise.player.pause(),void 0;if(t.hasClass("paused"))return Noise.player.play(),void 0;e(".play-album").removeClass("entypo-pause paused"),t.addClass("entypo-pause"),Noise.player.options.playAll=!0;var i=s.filter(function(){return""!=e(this).find(".play-track").data("url")});if(!i.length)return t.removeClass("entypo-pause"),Noise.player.options.playAll=!1,console.log("No playable track"),void 0;i.first().find(".play-track").trigger("click");var l,o;e(Noise.player.playlist).html(""),i.each(function(a){o=e(this).find(".play-track"),l=e("<li></li>"),l.attr("title",o.data("title")).text(o.data("title")).data({id:o.data("id"),url:o.data("url")}),0==a&&l.addClass("current played"),l.appendTo(Noise.player.playlist)})}),o.on("click",".play-track",function(a){a.preventDefault();var t=e(this).data("id");if(t!=Noise.player.currentTrack.data("id")){var s=Noise.player.playlist.children().filter(function(){return e(this).data("id")==t});s.length&&(Noise.player.currentTrack=s,Noise.player.currentTrack.addClass("current").siblings().removeClass("current"))}var i=e(this).parents(".album");if(!i.length)return Noise.player.options.playAll=!1,void 0;""!=e(this).data("url")&&(e(".album li.playing").removeClass("playing"),e(this).parents("li").addClass("playing"));var l=i.prev(".album-cover").find(".play-album");l.hasClass("paused")||l.hasClass("entypo-pause")||(Noise.player.options.playAll=!1)})})}(jQuery);